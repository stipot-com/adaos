# –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –Ω–∞–º–µ—Ä–µ–Ω–∏—è –≤ —Å–≤–æ–±–æ–¥–Ω–æ–º —Ç–µ–∫—Å—Ç–µ

## üß© 1. **Rhasspy** (–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω)

Rhasspy ‚Äî —ç—Ç–æ ¬´–æ—Ñ–ª–∞–π–Ω-stack –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞¬ª, –º–æ–¥—É–ª—å–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ Alexa/Google Home.
–û–Ω —É–º–µ–µ—Ç –≥–æ—Ä–∞–∑–¥–æ –±–æ–ª—å—à–µ, —á–µ–º OVOS, –Ω–æ –≤—Å–µ –º–æ–¥—É–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∏ –æ–±—â–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ HTTP/MQTT.
–¢—ã –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ.

### üîπ –ß—Ç–æ –≤–∑—è—Ç—å –∏–∑ Rhasspy

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç                          | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                                                         | –ö–∞–∫ –º–æ–∂–Ω–æ –≤—Å—Ç—Ä–æ–∏—Ç—å –≤ AdaOS                                                          |
| ---------------------------------- | ------------------------------------------------------------------ | ----------------------------------------------------------------------------------- |
| **Rhasspy NLU**                    | —É–º–µ–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å Rasa, Snips, Fsticuffs                            | –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –≤–Ω–µ—à–Ω–∏–π NLU endpoint (HTTP) –ø—Ä–∏ dev-—Ä–µ–∂–∏–º–µ –∏–ª–∏ –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ |
| **Rhasspy fuzzywuzzy / Pronounce** | —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∑–≤—É–∫–æ–≤—ã—Ö –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–æ—Ä–º                            | –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç–∏ –∏ —É—Å—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤                                       |
| **Entity Extractors**              | –≥–æ—Ç–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è `datetime`, `location`, `number`     | –º–æ–∂–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º regex-–º–æ–¥—É–ª—è–º                      |
| **Rhasspy Intent Graph**           | —É–º–µ–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å –¥–µ—Ä–µ–≤—å—è –Ω–∞–º–µ—Ä–µ–Ω–∏–π                                    | —ç—Ç–æ —É–∂–µ –ø–æ—á—Ç–∏ —Ç–æ, —á—Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ –¥–ª—è `arbiter`: –≤—ã–±–æ—Ä –Ω–∞–º–µ—Ä–µ–Ω–∏—è –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É        |
| **MQTT-—à–∏–Ω–∞ —Å–æ–±—ã—Ç–∏–π**              | –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ reference –¥–ª—è —Ç–≤–æ–µ–≥–æ event-bus –º–µ–∂–¥—É skills |                                                                                     |

Rhasspy —Ö–æ—Ä–æ—à —Ç–µ–º, —á—Ç–æ **–≤—Å—ë —Ä–∞–∑–±–∏—Ç–æ –Ω–∞ —Å–µ—Ä–≤–∏—Å—ã** ‚Äî —Ç—ã –º–æ–∂–µ—à—å –ø–æ–¥–Ω–∏–º–∞—Ç—å —Ç–æ–ª—å–∫–æ `rhasspy-nlu-hermes` –∏–ª–∏ `rhasspy-asr`, –Ω–µ —Ç—Ä–æ–≥–∞—è –æ—Å—Ç–∞–ª—å–Ω–æ–µ.

---

## Rhasspy NLU (–∫–∞–∫ –µ–¥–∏–Ω—ã–π –±–µ–∫–µ–Ω–¥)

**–ü–ª—é—Å—ã**

* –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Rasa, Snips, Fsticuffs, regex; REST API (text-to-intent).
* –ë–æ–≥–∞—Ç—ã–µ —ç–Ω—Ç–∏—Ç–∏-—ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä—ã, –≥—Ä–∞—Ñ –Ω–∞–º–µ—Ä–µ–Ω–∏–π, –ø—Ä–æ—Ñ–∏–ª–∏ —è–∑—ã–∫–æ–≤.
* –ë—ã—Å—Ç—Ä–æ –Ω–∞–∫—Ä—ã–≤–∞–µ—Ç RU/EN –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å –∏ —Å–ª–æ–∂–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã.

**–ú–∏–Ω—É—Å—ã**

* –û—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å (—Ä–µ—Å—É—Ä—Å—ã, –¥–µ–ø–ª–æ–π, –ª–∞–π—Ñ—Ü–∏–∫–ª, –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ).
* –°–µ—Ç–µ–≤–æ–π hop ‚Üí +–ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å; –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏.
* –®–∞–±–ª–æ–Ω—ã/—Å–ª–æ—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è ‚Äú—Å–Ω–∞—Ä—É–∂–∏‚Äù ‚Äî —Å–ª–æ–∂–Ω–µ–µ –¥–µ–ª–∞—Ç—å –≤–∞—à –º–∞–Ω–∏—Ñ–µ—Å—Ç –∫–∞–∫ single source of truth.

## graph-routed retriever nlu (grr-nlu)

–†–µ—Ç—Ä–∏–≤–µ—Ä —Å –≥—Ä–∞—Ñ–æ–≤—ã–º —Ä–æ—É—Ç–∏–Ω–≥–æ–º: **–º–∏–∫—Ä–æ-–¥—É–∞–ª—å–Ω—ã–π —ç–Ω–∫–æ–¥–µ—Ä (—Ä–µ—Ç—Ä–∏–≤–µ—Ä –∏–Ω—Ç–µ–Ω—Ç–æ–≤)** + **—Ç–æ–Ω–∫–∏–π –≥—Ä–∞—Ñ —Å–º—ã—Å–ª–æ–≤ (kg) —Å –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏** + **–æ–±—É—á–∞–µ–º—ã–π —Å–∫–æ—Ä–µ—Ä –ø—É—Ç–µ–π**. –æ–Ω–ª–∞–π–Ω ‚Äî –±—ã—Å—Ç—Ä–æ –∏ –±–µ–∑ llm; –æ—Ñ—Ñ–ª–∞–π–Ω ‚Äî llm-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–Ω–æ–Ω–∏–º–æ–≤/–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏ —Ä–µ–≤–∏–∑–∏—è —Ä—ë–±–µ—Ä.

### 1. —Å—É—â–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö (–æ–Ω—Ç–æ–ª–æ–≥–∏—è)

* `Goal` ‚Äî —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–ª—å/–∏–Ω—Ç–µ–Ω—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, `reminder.create`, `task.add`). –ø–æ–ª—è: `id`, `name`, `domain`, `version`, `skill_id`, `slots_schema`.
* `Concept` ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–º—ã—Å–ª–æ–≤–∞—è –µ–¥–∏–Ω–∏—Ü–∞/—Ç–µ—Ä–º–∏–Ω: `task`, `evening`, `tomorrow`. –ø–æ–ª—è: `id`, `lemma`, `domain`, `locale`.
* `SurfaceForm` ‚Äî –Ω–∞–±–ª—é–¥–∞–µ–º–∞—è —Ñ–æ—Ä–º–∞ —Ñ—Ä–∞–∑—ã/—Å–ª–æ–≤–∞: ¬´–∑–∞–¥–∞—á–∞¬ª, ¬´–¥–µ–ª–æ¬ª, ¬´–ø–æ—Å—Ç–∞–≤—å¬ª. –ø–æ–ª—è: `id`, `text`, `norm`, `locale`.
* `Pattern` ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π dsl-–ø–∞—Ç—Ç–µ—Ä–Ω (–Ω–µ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π regex): `SEQ("–ø–æ—Å—Ç–∞–≤—å", SLOT(task_title)?)` –∏ —Ç.–ø. –ø–æ–ª—è: `id`, `dsl`, `kind`, `confidence`, `source`.
* `Slot` ‚Äî –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π —Å–ª–æ—Ç —Ü–µ–ª–∏: `time`, `title`, `assignee` (+ —Ç–∏–ø).
* `Context` ‚Äî –∫–∞–Ω–∞–ª/—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ/—è–∑—ã–∫/—Ä–æ–ª—å: `telegram|voice|ru|owner`.
* `RuleEdge` ‚Äî –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–≤—è–∑–∏ c –≤–µ—Å–∞–º–∏:

  * `SURFACE_OF`(SurfaceForm‚ÜíConcept)
  * `MATCHES`(Pattern‚ÜíConcept/EntityType, weight)
  * `IMPLIES`(Concept‚ÜíGoal, weight)
  * `FILLS`(Concept‚ÜíSlot, weight)
  * `REQUIRES`(Goal‚ÜíContext/Slot)
  * `CONFLICTS_WITH`(X‚ÜîY, penalty)
  * `HANDLES`(Goal‚ÜíSkill)

–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã: –ø–æ `SurfaceForm.text(norm)`, `Concept.lemma+domain+locale`, `Goal.name+version`.

### 2. —Ö—Ä–∞–Ω–µ–Ω–∏–µ

* **po—Å**: sqlite (—Ç–∞–±–ª–∏—Ü—ã `nodes_*`, `edges_*`) + json-–∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏ —Å–ª–æ—Ç–æ–≤.
* **server**: neo4j/arangodb; –Ω–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –æ—Å—Ç–∞–≤–ª—è–µ–º –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–º–∏ (—á–µ—Ä–µ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π).
* **—Ä–µ—Ç—Ä–∏–≤–µ—Ä**: faiss ivf/flat + –ø–∞–º—è—Ç—å embeddings:

  * `E_u = encode(utterance, context)` ‚Äî 384/512-d (–¥–∏—Å—Ç–∏–ª–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —ç–Ω–∫–æ–¥–µ—Ä).
  * `E_g = encode(goal_text, slots_hints)` –¥–ª—è –≤—Å–µ—Ö —Ü–µ–ª–µ–π.
* —Å–Ω–∞–ø—à–æ—Ç—ã: `nlu-bundle-X.Y.Z/`:

  * `kg.graph.jsonl` (—É–∑–ª—ã/—Ä—ë–±—Ä–∞)
  * `retriever.index` + `goals_embeddings.npy`
  * `scorer.bin` (–ª–æ–≥—Ä–µ–≥/lightgbm)
  * `patterns.yml`
  * `tests/` (–ø–æ–∑–∏—Ç–∏–≤/–Ω–µ–≥–∞—Ç–∏–≤/—Å–º–µ–∂–Ω—ã–µ)

### 3. –æ–Ω–ª–∞–π–Ω-pipeline `/parse`

–≤—Å–µ–≥–¥–∞ ‚â§ 10‚Äì20 –º—Å –Ω–∞ cpu.

```
input: text u, optional context c (channel, device, locale, user_role)

S0 normalize: —Ç–æ–∫–µ–Ω—ã, lower, —Ä–∞—Å–∫–ª–∞–¥–∫–∞, –±—ã—Å—Ç—Ä–∞—è –æ—Ä—Ñ–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è (‚â§1 –ø—Ä–∞–≤–∫–∞/—Å–ª–æ–≤–æ).
S1 surface/pattern scan: ahocorasick + dsl-–ø–∞—Ç—Ç–µ—Ä–Ω—ã ‚Üí –∫–∞–Ω–¥–∏–¥–∞—Ç—ã Concepts/Slots (C0).
S2 retriever: kNN(E_u, E_g) ‚Üí topK —Ü–µ–ª–µ–π (G0, k‚âà8‚Äì16).
S3 path build: –¥–ª—è –∫–∞–∂–¥–æ–π —Ü–µ–ª–∏ –∏–∑ G0 —Å–æ–±–∏—Ä–∞–µ–º –¥–æ m –ø—É—Ç–µ–π Concept‚ÜíGoal,
    —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º —Å–ª–æ—Ç–æ–≤ –∏–∑ C0 –∏ –±—ã—Å—Ç—Ä—ã–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º —Å—É—â–Ω–æ—Å—Ç–µ–π (rule-NER).
S4 scoring: —Ñ–∏—á–∏ –ø—É—Ç–∏ F = [
    pattern_hits, surface_hits, kv_sim, context_fit,
    slot_coverage, conflicts, prior_goal_user, recency_goal_user
]
    score = sigmoid(w¬∑F)  // –ª–æ–≥—Ä–µ–≥/–ª—ë–≥–∫–∏–π gbdt
S5 resolve:
    if Œî(top1, top2) < œÑ ‚Üí –∫–æ—Ä–æ—Ç–∫–∏–π —É—Ç–æ—á–Ω—è—é—â–∏–π binary-–≤–æ–ø—Ä–æ—Å –∏–∑ —à–∞–±–ª–æ–Ω–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
S6 emit:
    {goal, slots, score, trace[:–ø—É—Ç—å –∏ –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏—è], needs_clarification?}
```

fallback (—Ä–µ–¥–∫–∏–π, ‚â§5% —Ç—Ä–∞—Ñ–∏–∫–∞): ¬´m-of-n¬ª –ø—Ä–∞–≤–∏–ª–∞ + –∫–æ—Ä–æ—Ç–∫–∏–π llm-router —Ç–æ–ª—å–∫–æ –¥–ª—è –∂—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫; —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ–º –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.

### 4. –æ—Ñ—Ñ–ª–∞–π–Ω —É–ª—É—á—à–µ–Ω–∏–µ (daily/weekly)

* **–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: `u, c, predicted, top2, score, user_feedback(accept|correct‚Üígoal‚Äô, slots‚Äô), trace`.
* **–¥–µ–¥—É–ø/—Å–∞–Ω–∏—Ç–∞—Ä–∫–∞ kg**: —Å–ª–∏—è–Ω–∏–µ –¥—É–±–ª–µ–π `Concept`, –≤—ã–Ω–æ—Å –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç–µ–π –≤ `domain`.
* **–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–Ω–æ–Ω–∏–º–æ–≤ –∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤**: llm –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç `SurfaceForm`/`Pattern` –≤ –Ω–∞—à dsl; –≤—Å—ë –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å `confidence‚âà0.3`, –ø—Ä–æ—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ-—Ç–µ—Å—Ç—ã –∏ –∫–∞–Ω–∞—Ä–µ–µ—á–∫—É.
* **–ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ —Å–∫–æ—Ä–µ—Ä–∞**: –æ–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Å–∞ –ø–æ —Å–≤–µ–∂–∏–º –ª–æ–≥–∞–º (class weight –Ω–∞ —Ä–µ–¥–∫–∏–µ —Ü–µ–ª–∏).
* **—Ä–µ–≥—É–ª—è—Ç–æ—Ä —Ä–æ—Å—Ç–∞**: –ª–∏–º–∏—Ç X –Ω–æ–≤—ã—Ö surface/–Ω–µ–¥–µ–ª—é/—Ü–µ–ª—å; –±–µ–∑ —Ä–µ–≤—å—é ‚Äî –Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ bundle.

### 5. api-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã (FastAPI)

**runtime**

```http
POST /parse
req: { "text": "–ø–æ—Å—Ç–∞–≤—å –∑–∞–¥–∞—á—É –Ω–∞ –≤–µ—á–µ—Ä", "context": {"channel":"telegram","locale":"ru"} }
res: {
  "goal": "reminder.create",
  "slots": {"time":"today 20:00","title":"–∑–∞–¥–∞—á–∞"},
  "score": 0.87,
  "needs_clarification": false,
  "trace": [{"feature":"kv_sim","value":0.72}, {"feature":"pattern_hits","value":2}, ...],
  "bundle": "1.2.0"
}
```

**learning/logs**

```http
POST /learn/event
{ "text": "...", "context": {...}, "predicted":"task.add",
  "accepted": false, "correct_goal":"reminder.create", "correct_slots":{...}, "trace": [...] }
```

**mgmt**

```http
GET /bundle/version          ‚Üí "1.2.0"
POST /bundle/reload          ‚Üí 200
POST /rules/propose (internal, guarded)
```

### 6. dsl –¥–ª—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (—É–∑–∫–∏–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π)

—Ü–µ–ª—å ‚Äî —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤.

```
# –ø—Ä–∏–º–∏—Ç–∏–≤—ã
TOK("–ø–æ—Å—Ç–∞–≤—å") | ANY() | NUM() | TIME() | DATE() | W() # —Å–ª–æ–≤–æ
OPT(X) | SEQ(X, Y, ...) | OR(X, Y) | SLOT(name, type, extractor?)

# –ø—Ä–∏–º–µ—Ä
SEQ(OR(TOK("–ø–æ—Å—Ç–∞–≤—å"), TOK("—Å–æ–∑–¥–∞–π")),
    OR(TOK("–∑–∞–¥–∞—á—É"), TOK("–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ")),
    OPT(SLOT("title", TEXT)),
    OPT(TOK("–Ω–∞")),
    OPT(SLOT("time", TIME|DATE))
)
```

* —Ö—Ä–∞–Ω–µ–Ω–∏–µ: `Pattern.dsl` –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ + precompiled dfa.
* —ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä—ã: —É–∑–∫–∏–µ (`TIME`, `DATE`, `DURATION`, `CONTACT`, `NUMBER`).

### 7. –æ–±—É—á–∞–µ–º—ã–π —Å–∫–æ—Ä–µ—Ä (–ø—Ä–æ—Å—Ç–æ –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ)

* **—Ñ–∏—á–∏** (–Ω–∞ –ø—É—Ç—å):

  * `kv_sim` ‚Äî –∫–æ—Å–∏–Ω—É—Å –º–µ–∂–¥—É `E_u` –∏ `E_goal`.
  * `pattern_hits` ‚Äî —Å—É–º–º–∞—Ä–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å `MATCHES`.
  * `surface_hits` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ/–≤–µ—Å–∞ `SURFACE_OF`.
  * `context_fit` ‚Äî —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å `REQUIRES` —Å `Context`.
  * `slot_coverage` ‚Äî –¥–æ–ª—è —Å–ª–æ—Ç–æ–≤, –∑–∞–∫—Ä—ã—Ç–∞—è –ø—Ä–∞–≤–∏–ª–∞–º–∏/—ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä–∞–º–∏.
  * `conflicts` ‚Äî —à—Ç—Ä–∞—Ñ –∑–∞ –∞–∫—Ç–∏–≤–Ω—ã–µ `CONFLICTS_WITH`.
  * `prior_goal_user`, `recency_goal_user` ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Å–ª–∞–±—ã–µ –ø—Ä–∏–æ—Ä—ã.
* **–º–æ–¥–µ–ª—å**: –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è (baseline), –∑–∞—Ç–µ–º lightgbm. —Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–ª–∏–±—Ä–æ–≤–∫—É (Platt).

### 8. –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–µ–ª–∏–∑—ã

* –µ–¥–∏–Ω–∏—Ü–∞ –ø–æ—Å—Ç–∞–≤–∫–∏: **`nlu-bundle`**. –∞—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—Ç–∫–∞—Ç.
* —Å–µ–º–≤–µ—Ä:

  * patch: –ø—Ä–∞–≤–∫–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤/–≤–µ—Å–æ–≤ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º.
  * minor: –Ω–æ–≤—ã–µ —Ü–µ–ª–∏/—Å–ª–æ—Ç—ã/–ø–∞—Ç—Ç–µ—Ä–Ω—ã; –º–∏–≥—Ä–∞—Ü–∏–∏ kg.
  * major: —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å api/–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.
* –∫–∞–Ω–∞—Ä–µ–µ—á–∫–∞: 5‚Äì10% —É–∑–ª–æ–≤/—á–∞—Ç–æ–≤, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ `goal_accuracy@1` –∏ `clarify_rate`.

### 9. ci/cd –∏ —Ç–µ—Å—Ç—ã-—Å—Ç–æ—Ä–æ–∂–∞

* –Ω–∞ –∫–∞–∂–¥—ã–π –Ω–æ–≤—ã–π `Pattern` –∏ `IMPLIES` ‚Üí –∞–≤—Ç–æ–≥–µ–Ω –∫–µ–π—Å–æ–≤:

  * –ø–æ–∑–∏—Ç–∏–≤—ã (–ø—Ä—è–º—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏),
  * –Ω–µ–≥–∞—Ç–∏–≤—ã (—Å–º–µ–∂–Ω—ã–µ –¥–æ–º–µ–Ω—ã),
  * –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–µ –ø–∞—Ä—ã (–æ–∂–∏–¥–∞–µ–º —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å).
* github actions: `bundle build ‚Üí unit (dsl, scorer) ‚Üí e2e on fixtures ‚Üí pack ‚Üí push registry`.
* ¬´–∫—Ä–∞—Å–Ω–∞—è –∫–Ω–æ–ø–∫–∞¬ª –æ—Ç–∫–∞—Ç–∞: `/bundle/reload?version=prev`.

### 10. –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ adaos

* —Å–µ—Ä–≤–∏—Å `adaos-nlu` (python, fastapi, uvicorn), –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å ¬´—Ç–æ–ª—å–∫–æ cpu¬ª.
* **rhasspy io**: –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ ASR ‚Üí `/parse` ‚Üí goal/slots ‚Üí skill-router.
* **skill-router**: `Goal.HANDLES ‚Üí Skill`, –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ `slots_schema`.
* **–ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ hub**: runtime-—á–∞—Å—Ç—å (retriever+dfa+scorer) –∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π bundle; –æ—Ñ—Ñ–ª–∞–π–Ω-–æ–±—É—á–µ–Ω–∏–µ –∏ llm ‚Äî –Ω–∞ root.
* **—Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è**: —Å–æ–±—ã—Ç–∏—è `/learn/event` –Ω–∞ root c –∞–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏–µ–π.

### 11. –º–µ—Ç—Ä–∏–∫–∏ –∏ –ø–æ—Ä–æ–≥–∏

* –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–µ: `goal_accuracy@1`, `slot_f1`, `clarify_rate<=8%`, `latency_p95<=30ms`, `cost/op‚âà0`.
* —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ: `coverage_by_domain`, `collision_rate(top2_gap<œÑ)`, ¬´–¥–æ–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã—Ö —Ñ–æ—Ä–º¬ª (—Ç—Ä–∏–≥–≥–µ—Ä –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏).
* –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å: –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å—ã—Ä—ã–µ —Ç–µ–∫—Å—Ç—ã ‚Äî —Ç–æ–ª—å–∫–æ —Ö—ç—à/—ç–º–±–µ–¥–¥–∏–Ω–≥ + —É—Å–µ—á—ë–Ω–Ω—ã–µ n-–≥—Ä–∞–º–º—ã –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

### 12. –ø–ª–∞–Ω po—Å (2‚Äì3 –Ω–µ–¥–µ–ª–∏ —á–∏—Å—Ç–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏)

1. –Ω–µ–¥–µ–ª—è 1:

   * –∫–∞—Ä–∫–∞—Å fastapi + —Ñ–æ—Ä–º–∞—Ç `nlu-bundle` + –∑–∞–≥—Ä—É–∑—á–∏–∫;
   * dsl-–ø–∞—Ç—Ç–µ—Ä–Ω—ã (–∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –≤ dfa) + ahocorasick;
   * –º–∏–Ω–∏-—Ä–µ—Ç—Ä–∏–≤–µ—Ä (sentence-embeddings –∏–∑ –≥–æ—Ç–æ–≤–æ–π –º–æ–¥–µ–ª–∏) + faiss flat;
   * –±–∞–∑–æ–≤—ã–π —Å–∫–æ—Ä–µ—Ä (–ª–æ–≥—Ä–µ–≥ —Å —Ä—É–∫–∞–º–∏ –∑–∞–¥–∞–Ω–Ω—ã–º–∏ –≤–µ—Å–∞–º–∏).
2. –Ω–µ–¥–µ–ª—è 2:

   * sqlite-kg + —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π;
   * 10‚Äì15 —Ü–µ–ª–µ–π (ru) –¥–ª—è —Ç–µ–ª–µ–≥—Ä–∞–º/–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π/–∑–∞–¥–∞—á/–º—É–∑—ã–∫–∏;
   * –∂—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `/learn/event`, –∞–≤—Ç–æ—Å–±–æ—Ä–∫–∞ —Ç–µ—Å—Ç–æ–≤-—Å—Ç–æ—Ä–æ–∂–µ–π;
   * –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å skill-router adaos.
3. –Ω–µ–¥–µ–ª—è 3:

   * –æ–±—É—á–∞–µ–º—ã–π —Å–∫–æ—Ä–µ—Ä –Ω–∞ –ª–æ–≥–∞—Ö, –∫–∞–Ω–∞—Ä–µ–µ—á–∫–∞, —Ä–µ–ª–∏–∑ `bundle 0.1.0`;
   * ¬´—É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã¬ª –ø–æ `CONFLICTS_WITH`;
   * –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Ñ—Ñ–ª–∞–π–Ω-–ø–æ—Ç–æ–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–Ω–æ–Ω–∏–º–æ–≤ (llm‚Üíreview‚Üítests‚Üíbundle).

### 13. –ø—Ä–∏–º–µ—Ä—ã –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

**goal (yaml)**

```yaml
id: reminder.create
domain: personal
slots_schema:
  time: {type: datetime, required: false}
  title: {type: text, required: true}
skill_id: skills.reminder
version: 1
```

**pattern (yaml)**

```yaml
id: p_set_reminder
kind: dsl
dsl: 'SEQ(OR(TOK("–ø–æ—Å—Ç–∞–≤—å"),TOK("—Å–æ–∑–¥–∞–π")), TOK("–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ"), OPT(TOK("–Ω–∞")), OPT(SLOT("time", TIME)), OPT(SLOT("title", TEXT)))'
confidence: 0.6
source: "seed.manual"
```

**edge (jsonl)**

```json
{"type":"SURFACE_OF","from":"–∑–∞–¥–∞—á–∞","to":"task","weight":1.0}
{"type":"IMPLIES","from":"task","to":"task.add","weight":0.7}
{"type":"IMPLIES","from":"task","to":"reminder.create","weight":0.3}
{"type":"CONFLICTS_WITH","from":"task.add","to":"reminder.create","penalty":0.4}
{"type":"REQUIRES","from":"reminder.create","to":"Context(locale=ru)","weight":0.2}
```

**clarify-template**

```yaml
pair: [task.add, reminder.create]
prompt_ru: "—ç—Ç–æ –∑–∞–¥–∞—á–∞ –≤ —Å–ø–∏—Å–æ–∫ –¥–µ–ª –∏–ª–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ?"
answers: ["–¥–µ–ª–æ","–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ"]
```

### 14. –ù–∞ MVP–æ–∫, –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ–º –∏–º—è, –∫—Ä–∏—Ç–µ—Ä–∏–∏ ¬´–≤–≤—è–∑–∞—Ç—å—Å—è/–Ω–µ –≤–≤—è–∑–∞—Ç—å—Å—è¬ª –∏ —Ñ–æ—Ä–º–∞—Ç mvp

#### mvp-—Å–∫–æ—É–ø (—á—Ç–æ –≤—Ö–æ–¥–∏–º)

* —Ä–µ—Ç—Ä–∏–≤–µ—Ä: –≥–æ—Ç–æ–≤–∞—è –º–∞–ª–µ–Ω—å–∫–∞—è —ç–º–±–µ–¥–¥–∏–Ω–≥-–º–æ–¥–µ–ª—å (384/512d) + faiss flat/ivf.
* –º–∏–Ω–∏-kg –≤ sqlite: `Goal`, `Concept`, `SurfaceForm`, `CONFLICTS_WITH`, `IMPLIES`.
* dsl-–ø–∞—Ç—Ç–µ—Ä–Ω—ã (—É–∑–∫–∏–π, –±–µ–∑ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö regex) + ahocorasick.
* –æ–±—É—á–∞–µ–º—ã–π —Å–∫–æ—Ä–µ—Ä: –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è –ø–æ 6‚Äì8 —Ñ–∏—á–∞–º –ø—É—Ç–∏.
* —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∑–∞—Ä–∞–Ω–µ–µ –∑–∞–¥–∞–Ω–Ω—ã–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã–º –ø–∞—Ä–∞–º.
* `nlu-bundle` —Å —Å–µ–º–≤–µ—Ä–æ–º –∏ –∞–≤—Ç–æ—Ç–µ—Å—Ç–∞–º–∏-—Å—Ç–æ—Ä–æ–∂–∞–º–∏.
* –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å adaos: `/parse`, `/learn/event`, —Ä–æ—É—Ç–µ—Ä –Ω–∞–≤—ã–∫–æ–≤.

#### —á—Ç–æ —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ **–ù–ï** –¥–µ–ª–∞–µ–º –≤ mvp

* neo4j/arangodb ‚Üí –ø–æ–∑–∂–µ; –ø–æ–∫–∞ sqlite/jsonl.
* –æ–Ω–ª–∞–π–Ω-llm ‚Üí —Ç–æ–ª—å–∫–æ –æ—Ñ—Ñ–ª–∞–π–Ω –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–Ω–æ–Ω–∏–º–æ–≤, –∏ —Ç–æ –ø–æ–∑–¥–Ω–µ–µ.
* –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—é/–∏—Å—Ç–æ—Ä–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –æ—Ç–ª–æ–∂–∏—Ç—å.
* —Å–ª–æ–∂–Ω—ã–µ —Ç–∏–ø—ã —Å–ª–æ—Ç–æ–≤ (–≥–µ–æ-–∏–µ—Ä–∞—Ä—Ö–∏–∏, –∫–æ–Ω—Ç–∞–∫—Ç-–±—É–∫–∏) ‚Üí –æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–æ—Å—Ç—ã–µ `TIME|DATE|TEXT|NUMBER`.

#### –∫—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ mvp (—Ü–∏—Ñ—Ä—ã, —á—Ç–æ–±—ã –∑–∞–∫—Ä—ã—Ç—å —ç—Ç–∞–ø)

* `goal_accuracy@1 ‚â• 85%` –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –Ω–∞–±–æ—Ä–µ –∏–∑ –≤–∞—à–∏—Ö —Ä–µ–∞–ª—å–Ω—ã—Ö –ª–æ–≥–æ–≤/—Å–∫—Ä–∏–ø—Ç–æ–≤—ã—Ö —Ñ—Ä–∞–∑ –ø–æ 10‚Äì15 —Ü–µ–ª—è–º.
* `slot_f1 ‚â• 0.80` –ø–æ ¬´time/title¬ª.
* `clarify_rate ‚â§ 10%` –Ω–∞ –æ–Ω–ª–∞–π–Ω–µ, –±–µ–∑ —Ä–æ—Å—Ç–∞ –æ—Ç–∫–∞–∑–æ–≤.
* `p95 latency ‚â§ 30 ms` –Ω–∞ cpu.
* ¬´–¥–æ–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö surface¬ª —Å–Ω–∏–∂–∞–µ—Ç—Å—è –Ω–µ–¥–µ–ª—è –∫ –Ω–µ–¥–µ–ª–µ.

#### –ø–ª–∞–Ω –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–∏–ø–æ—Ç–µ–∑ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –∏–Ω–∞—á–µ –ª–µ–≥–∫–æ ¬´–≤–ª—é–±–∏—Ç—å—Å—è¬ª)

* –∞–±–ª—è—Ü–∏–∏ –Ω–∞ –æ–¥–Ω–æ–º –∏ —Ç–æ–º –∂–µ –Ω–∞–±–æ—Ä–µ:
  a) **retriever-only** (–±–µ–∑ kg/–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤),
  b) **patterns-only** (–±–µ–∑ —Ä–µ—Ç—Ä–∏–≤–µ—Ä–∞),
  c) **grr-nlu** (–≥–∏–±—Ä–∏–¥).
* –µ—Å–ª–∏ (c) –Ω–µ –¥–∞—ë—Ç **+5‚Äì10 –ø.–ø.** –∫ accuracy@1 –ø—Ä–æ—Ç–∏–≤ (a) **–∏–ª–∏** –Ω–µ —Å–Ω–∏–∂–∞–µ—Ç clarify_rate –∑–∞–º–µ—Ç–Ω–æ ‚Äî **–ø–∏–≤–æ—Ç** –∫ —É–ª—É—á—à–µ–Ω–∏—é retriever-only (–∫–æ–Ω—Ç—Ä–∞—Å—Ç–∏–≤–∫–∞, –±–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –Ω–∞ —Ü–µ–ª—å), –∞ kg –æ—Å—Ç–∞–≤–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –¥–ª—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤/–æ–±—ä—è—Å–Ω–∏–º–æ—Å—Ç–∏.

#### —Ä–∏—Å–∫–∏ –∏ –∫–∞–∫ –∏—Ö –æ–±—É–∑–¥–∞—Ç—å

* —Ä–æ—Å—Ç –≥—Ä–∞—Ñ–∞ –∏ ¬´–∫–æ—Å—Ç—ã–ª–µ–π¬ª –≤ –ø–∞—Ç—Ç–µ—Ä–Ω–∞—Ö: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π dsl, –ª–∏–º–∏—Ç—ã –Ω–∞ –Ω–æ–≤—ã–µ —É–∑–ª—ã/–Ω–µ–¥–µ–ª—é, —Å–∞–Ω–∏—Ç–∞—Ä–Ω—ã–µ –ø—Ä–æ—Ö–æ–¥—ã.
* –¥—Ä–µ–π—Ñ –≤–µ—Å–æ–≤: —Ä–µ–≥—É–ª—è—Ä–Ω—ã–π –ø–µ—Ä–µ—Å—á—ë—Ç —Å–∫–æ—Ä–µ—Ä–∞ –∏ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏; —Ö—Ä–∞–Ω–∏—Ç—å –∏—Ö –≤ bundle.
* –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤: –∞—Ç–æ–º–∞—Ä–Ω—ã–µ —Ä–µ–ª–∏–∑—ã `nlu-bundle` –∏ –±—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç.
* ¬´–º—ã –≤—Å—ë —Ä–∞–≤–Ω–æ –∑–æ–≤—ë–º llm –æ–Ω–ª–∞–π–Ω¬ª: –∂—ë—Å—Ç–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–π –ª–∏–º–∏—Ç —Ñ–æ–ª–±—ç–∫–∞ –∏ –∑–∞–ø—Ä–µ—Ç –∞–≤—Ç–æ–ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.

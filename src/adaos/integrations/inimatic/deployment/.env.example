# ---------- Project / Domains ----------
COMPOSE_PROJECT_NAME=inimatic
APP_DOMAIN=app.inimatic.com
API_DOMAIN=api.inimatic.com
ROOT_BASE_URL=https://api.inimatic.com
DEPLOY_HOST=91.98.90.254

# ---------- Runtime ----------
PRODUCTION=1
HOST=0.0.0.0
PORT=3030
BACKEND_DEFAULT_LOCALE=en
DEBUG_ENDPOINTS=true

# ---------- ACME / nginx-proxy companion ----------
# Используется сервисом acme как DEFAULT_EMAIL (compose: env_file -> /opt/inimatic/.env)
DEFAULT_EMAIL=connect@stipot.com

# ---------- Bootstrap ----------
# Root API bootstrap / owner token used by /v1/bootstrap_token
ROOT_TOKEN=dev-root-token
# Web session JWT signing secret (used for Browser<->Root auth on `/hubs/*`).
# IMPORTANT: keep this stable across restarts; otherwise previously issued `session_jwt` will become invalid.
WEB_SESSION_JWT_SECRET=change-me-long-random

# ---------- Forge / Git integration ----------
FORGE_GIT_URL=git@github.com:stipot-com/adaos-forge.git
FORGE_REPO=stipot-com/adaos-forge
FORGE_WORKDIR=/data/forge
FORGE_GIT_AUTHOR_NAME="AdaOS Root"
FORGE_GIT_AUTHOR_EMAIL=bot@stipot.com
# пути должны совпадать с монтированием в compose (см. backend_* -> /run/inimatic/ssh/* и /run/inimatic/secrets/*)
FORGE_SSH_KEY=/opt/inimatic/ssh/forge_ssh_key
FORGE_SSH_KEY_RUNTIME=/run/inimatic/ssh/forge_ssh_key
GH_APP_OWNER=stipot-com

# GitHub App credentials (патч: путь выровнен с compose)
GH_APP_ID=1998120
GH_APP_INSTALLATION_ID=87081997
GH_APP_PRIVATE_KEY_FILE=/opt/inimatic/secrets/github-app.pem
# для host-скриптов (новые переменные)
GH_APP_PRIVATE_KEY_FILE_HOST=/opt/inimatic/secrets/github-app.pem
GH_APP_META_FILE_HOST=/opt/inimatic/secrets/github-app.json

# ---------- AdaOS bridge (backend -> local hub) ----------
ADAOS_BASE=http://127.0.0.1:8777
ADAOS_TOKEN=dev-local-token

# ---------- Root CA / TLS for backend (server-side) ----------
# Выровнено с compose: /opt/inimatic/secrets
CA_KEY_PEM_FILE=/run/inimatic/secrets/ca/ca.key
CA_CERT_PEM_FILE=/run/inimatic/secrets/ca/ca.crt
TLS_KEY_PEM_FILE=/run/inimatic/secrets/tls/tls.key.pem
TLS_CERT_PEM_FILE=/run/inimatic/secrets/tls/tls.cert.pem

# ---------- RootSettings: параметры для клиентов-хабов (документируем и держим рядом) ----------
# Эти переменные читает ХАБ (не root), но фиксируем их тут как «источник правды».
# На хабе они могут быть переиспользованы 1:1.
ROOT_BASE_URL=https://api.inimatic.com
ROOT_TG_PAIRING_PATH=/v1/pair/confirm

# mTLS развилка для endpoint'а:
# - Если на nginx (vhost.d) mTLS ОТКЛЮЧЕН для /v1/pair/confirm, оставляем false
# - Если решите включить mTLS клиенту (хабу) — поставить true на стороне хаба и выдать ему client cert/key/ca
ROOT_MTLS_ENABLED=false
# Пути для клиентских сертификатов (используются ХАБОМ, не root; оставляем как документацию)
ROOT_MTLS_CERT_PATH=/etc/adaos/mtls/client.crt
ROOT_MTLS_KEY_PATH=/etc/adaos/mtls/client.key
ROOT_MTLS_CA_PATH=/etc/adaos/mtls/ca.pem

# ---- Telegram bots ----
TG_BOTS=adaos_bot
TG_BOT_TOKEN=
TG_ADAOS_BOT_BOT_TOKEN_FILE=/run/inimatic/secrets/tg/main.token
TG_ADAOS_BOT_BOT_SECRET_FILE=/run/inimatic/secrets/tg/main.secret
# необязательно, но удобно централизовать базу/префикс вебхуков
TG_WEBHOOK_BASE=https://api.inimatic.com
ROOT_TG_PAIRING_PATH=/io/tg/pair/confirm
TG_WEBHOOK_PATH_PREFIX=/io/tg/adaos_bot/webhook
DEFAULT_HUB=dev

# ---- NATS / JetStream (root-only) ----
IO_BUS_KIND=nats
NATS_HOST=nats
NATS_PORT=4222
NATS_URL=nats://adaos:TetL5b305eiz@nats:4222
NATS_USER=adaos
NATS_PASS=TetL5b305eiz
# Управляйка NATS на 8222 (локально внутри сети proxy)
NATS_HTTP_PORT=8222
# NATS config (used by scripts/nats.conf and backend auth callout)
NATS_ISSUER_PUB=
NATS_AUTH_PASSWORD=change-me-strong
# Domain for WS exposure via nginx-proxy (TLS is terminated at proxy)
NATS_WS_HOST=nats.inimatic.com

# Backend signer for issuing JWTs in /internal/nats/authz
NATS_ISSUER_SEED=

# ---------- PostgreSQL (for Telegram multi-hub routing)
PG_USER=inimatic
PG_PASS=inimatic
PG_DB=inimatic
PG_HOST=postgres
PG_PORT=5432
PG_URL=postgres://${PG_USER}:${PG_PASS}@${PG_HOST}:${PG_PORT}/${PG_DB}

# Enable new Telegram multi-hub router (behind webhook)
TG_ROUTER_ENABLED=1


# ---------- IO / Limits (дополнения из Block 1) ----------
# Хабу пригодится; держим одинаковое имя переменной в экосистеме (root/хаб).
MAX_TG_FILE_MB=20
REDIS_URL=redis://redis:6379/0

# ---------- (legacy/optional) ----------
LE_EMAIL=admin@inimatic.com
